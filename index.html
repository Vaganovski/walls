<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>

    <style media="screen">
    .button {
      width:50px;
      height: 50px;
      cursor: pointer;
    }
    .up {
      background: url('stuff/u.png') no-repeat center;
      position: absolute; top:0; left:50px;
    }

    .left {
      background: url('stuff/l.png') no-repeat center;
      position: absolute; top:50px; left:0px;
    }
    .right {
      background: url('stuff/r.png') no-repeat center;
      position: absolute; top:50px; left:100px;
    }
    .down {
      background: url('stuff/d.png') no-repeat center;
      position: absolute; top:100px; left:50px;
    }

    .wall {
      background: url('stuff/wall.png') no-repeat top;
      position: absolute; top:50px; left:180px; width: 100px;
      text-align: center; padding-top: 30px; height: 25px;
    }

    .corner {
      background: url('stuff/corner.png') no-repeat top;
      position: absolute; top:50px; right:380px; width: 50px;
      text-align: center; padding-top: 50px; height: 25px;
    }

    .window {
      background: url('stuff/window.png') no-repeat top;
      position: absolute; top:50px; left:300px; width: 50px;
      text-align: center; padding-top: 50px; height: 25px;
    }

    .door {
      background: url('stuff/door.png') no-repeat top;
      position: absolute; top:50px; left:370px; width: 50px;
      text-align: center; padding-top: 50px; height: 25px;
    }

    .len {
      text-align: right;
      position: absolute; width: 150px; top: 20px; right:110px;
    }

    input {width: 50px;}

    .wid {
      text-align: right;
      position: absolute; width: 150px; top: 80px; right:110px;
    }

    #ok {
      position: absolute; top:20px; right:20px; width: 80px;
    }

    #next {
      position: absolute; top:80px; right:20px; width: 80px;
    }

    .divider {height: 100%; width:2px; background:#c55a11; position: absolute;}
    </style>
  </head>
  <body onload="init();">
<div style="width:901px; border:2px solid #fee599; padding:20px;">
<canvas id="testCanvas" width="901" height="601"></canvas>

<div id="form" style="height:150px; border:2px solid #c55a11; background:#deebf7; position: relative;">

<div id="up" class="button up"></div>
<div id="left" class="button left"></div>
<div id="right" class="button right"></div>
<div id="down" class="button down"></div>

<div class="divider" style="left:170px;"></div>

<div id="wall" class="button wall">Стена</div>
<div id="window" class="button window">Окно</div>
<div id="door" class="button door">Дверь</div>
<div class="divider" style="left:450px;"></div>
<div class="len">
  <label id="line1">Длина: </label><input type="text" id="len"><label> см.</label>
</div>

<div class="wid">
  <label id="line2">Ширина: </label><input type="text" id="wid">  <label> см.</label>
</div>

<button type="button" name="next" id="next">Далее</button>
<button type="button" name="ok" id="ok">OK</button>

</div>

<script type="text/javascript" src="js/easeljs-NEXT.min.js"></script>
<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
<script>
	var canvas, g;
	var stage, container, line1, line2;
  var dir, element, offsetX=0, offsetY=0, contX, contY;
  var lastLen=0, lastWid=0, lastDir, lastX=300, lastY=300, lastL=0;
  var ppm = 50, corner=0; erase = false;
	function init() {
		canvas = document.getElementById("testCanvas");
		stage = new createjs.Stage(canvas);

    stage.enableMouseOver(5);

    stage.on("pressmove", function(evt) {
        container.x = contX+evt.stageX-offsetX;
        container.y = contY+evt.stageY-offsetY;
        stage.update();
    });

    stage.on("mousedown", function(evt) {
      contX = container.x; contY = container.y;
      offsetX=evt.stageX; offsetY = evt.stageY;
    });

    var grid = new createjs.Shape();

    grid.graphics.beginStroke("#bbbbbb").setStrokeStyle(0.5);

    for (var i = 0; i < 4*canvas.width/ppm; i++) {
      grid.graphics.moveTo(i*ppm-2*canvas.width,-canvas.height*2).lineTo(i*ppm-2*canvas.width, canvas.height*2);
    }
    for (var i = 0; i < 4*canvas.height/ppm; i++) {
      grid.graphics.moveTo(-2*canvas.width,i*ppm-2*canvas.height).lineTo(canvas.width*2, i*ppm-2*canvas.height);
    }

    g = new createjs.Graphics();
    g.setStrokeStyle(2);
    g.beginStroke("#000000");
    //g.beginFill("#5b9bd5");

    container = new createjs.Container();
    container.cursor = "all-scroll";
    stage.addChild(container);

    container.addChild(grid);

    var shape = new createjs.Shape(g);
    container.addChild(shape);

    stage.update();
	}


  $(document).ready(function() {
      $("#up, #down, #left, #right").click(function(event) {
          dir = event.target.id;
          $("#up, #down, #left, #right").css('opacity', 1);
          $(this).css('opacity', 0.5);
      });

      $("#ok").click(function(event) {
          $("#form").hide();
      });

      $("#corner").click(function(event) {
          corner = 1 - corner;
          if (corner) {
            $("#corner").css('opacity', 1);
          } else {
            $("#corner").css('opacity', 0.5);
          }

      });

      $("#corner").css('opacity', 0.5);

      $("#wall, #door, #window").click(function(event) {
          element = event.target.id;
          $("#wall, #door, #window").css('opacity', 1);
          $(this).css('opacity', 0.5);
          if (element == "window" || element == "door") {
            line1.text("Длина1: ");
            line2.text("Длина2: ");
          } else {
            line1.text("Длина: ");
            line2.text("Ширина: ");
          }
      });

      line1 = $("#line1");line2 = $("#line2");

      $("#next").click(function(event) {
          var len = parseInt($("#len").val())*ppm/100;
          var wid = parseInt($("#wid").val())*ppm/100;

          if (element == "wall") {
            g.beginFill("#ffffff");
            if (dir == "right") {
              if (lastDir=="down") {
                lastX = lastX+lastWid;
                lastY = lastY+lastLen-wid;
                lastDir = dir;
                lastLen = len-lastWid;
                g.drawRect(lastX, lastY ,lastLen, wid);
                lastWid = wid; lastL=len;
                erase=true;
              } else if (lastDir=="up") {
                lastX = lastX;
                lastY = lastY-wid;
                lastDir = dir;
                lastLen = len+lastWid;
                g.drawRect(lastX, lastY ,lastLen, wid);
                lastWid = wid; lastL=len;
                erase=true;
              } else if (!lastDir) {
                lastDir = dir;
                g.drawRect(lastX, lastY ,len, wid);
                lastLen = len; lastWid = wid; lastL=len;
                erase=true;
              }
            } else if (dir == "left") {
              if (lastDir=="down") {
                lastX = lastX-len;
                lastY = lastY+lastLen;
                lastDir = dir;
                lastLen = len+lastWid;
                g.drawRect(lastX, lastY ,lastLen, wid);
                lastWid = wid;lastL=len;
                erase=true;
              } else if (lastDir=="up") {
                lastX = lastX-len+lastWid;
                lastY = lastY;
                lastDir = dir;
                lastLen = len-lastWid;
                g.drawRect(lastX, lastY ,lastLen, wid);
                lastWid = wid; lastL=len;
                erase=true;
              } else if (!lastDir) {
                lastDir = dir;
                lastX = lastX-len;
                g.drawRect(lastX, lastY ,len, wid);
                lastLen = len; lastWid = wid; lastL=len;
                erase=true;
              }
            } else if (dir == "up") {
              if (lastDir=="right") {
                lastX = lastX+lastLen-wid;
                lastY = lastY-len+lastWid;
                lastDir = dir;
                lastLen = len-lastWid;
                g.drawRect(lastX, lastY ,wid, lastLen);
                lastWid = wid; lastL=len;
                erase=true;
              } else if (lastDir=="left") {
                lastX = lastX-wid;
                lastY = lastY-len;
                lastDir = dir;
                lastLen = len+lastWid;
                g.drawRect(lastX, lastY ,wid, lastLen);
                lastWid = wid; lastL=len;
                erase=true;
              } else if (!lastDir) {
                lastDir = dir;
                lastY = lastY-len;
                g.drawRect(lastX, lastY ,wid, len);
                lastLen = len; lastWid = wid; lastL=len;
                erase=true;
              }
            } else if (dir == "down") {
              if (lastDir=="right") {
                lastX = lastX+lastLen;
                lastY = lastY;
                lastDir = dir;
                lastLen = len+lastWid;
                g.drawRect(lastX, lastY ,wid, lastLen);
                lastWid = wid;lastL=len;
                erase=true;
              } else if (lastDir=="left") {
                lastX = lastX;
                lastY = lastY+lastWid;
                lastDir = dir;
                lastLen = len-lastWid;
                g.drawRect(lastX, lastY ,wid, lastLen);
                 lastWid = wid;lastL=len;
                 erase=true;
              } else if (!lastDir) {
                lastDir = dir;
                g.drawRect(lastX, lastY ,wid, len);
                lastLen = len; lastWid = wid;lastL=len;
                erase=true;
              }
            }
          } else if (element == "window" && wid<=lastL) {
            g.beginFill("#FFFFFF");
            var deltaL = lastL-lastLen;
            if (lastDir == "right") {
              g.drawRect(lastX+len-deltaL, lastY ,wid-len, lastWid/2);
              g.drawRect(lastX+len-deltaL, lastY+lastWid/2 ,wid-len, lastWid/2);
            } else if (lastDir == "left") {
              g.drawRect(lastX+lastLen-wid+deltaL, lastY ,wid-len, lastWid/2);
              g.drawRect(lastX+lastLen-wid+deltaL, lastY+lastWid/2 ,wid-len, lastWid/2);
            } else if (lastDir == "up") {
              g.drawRect(lastX, lastY + lastLen-wid+deltaL ,lastWid/2, wid-len);
              g.drawRect(lastX+lastWid/2, lastY + lastLen-wid+deltaL ,lastWid/2, wid-len);
            } else if (lastDir == "down") {
              g.drawRect(lastX, lastY+len-deltaL ,lastWid/2, wid-len);
              g.drawRect(lastX+lastWid/2, lastY+len-deltaL ,lastWid/2, wid-len);
            }
            erase=true;
          } else if (element == "door") {
            var deltaL = lastL-lastLen;
            g.beginFill("#FFFFFF");
            var shape = new createjs.Shape();
            shape.graphics.beginStroke("#000000").setStrokeStyle(1).moveTo(0,0);
            if (lastDir == "right") {
              g.drawRect(lastX+len-deltaL, lastY ,wid-len, lastWid);
              shape.graphics.lineTo(0, 2*lastWid);
              shape.x = lastX+len/2+wid/2-deltaL; shape.y = lastY-lastWid/2;
            } else if (lastDir == "left") {
              g.drawRect(lastX+lastLen-wid+deltaL, lastY ,wid-len, lastWid);
              shape.graphics.lineTo(0, 2*lastWid);
              shape.x = lastX+lastLen-wid/2-len/2+deltaL; shape.y = lastY-lastWid/2;
            } else if (lastDir == "up") {
              g.drawRect(lastX, lastY + lastLen-wid+deltaL ,lastWid, wid-len);
              shape.graphics.lineTo(2*lastWid, 0);
              shape.x = lastX-lastWid/2; shape.y = lastY + lastLen-wid/2-len/2+deltaL;
            } else if (lastDir == "down") {
              g.drawRect(lastX,lastY+len-deltaL ,lastWid, wid-len);
              shape.graphics.lineTo(2*lastWid, 0);
              shape.x = lastX-lastWid/2; shape.y = lastY + len/2 + wid/2-deltaL;
            }

            container.addChild(shape);
            erase=true;
          }

          element="";
          //lastDir = dir;
          //lastLen = len; lastWid = wid;

          stage.update();
          $("#wall, #door, #window").css('opacity', 1);


          if (erase==true) {
            $("#len").val("");
            $("#wid").val("");
            erase = false;
          }
      });

  });

</script>


  </body>
</html>
